# AI Telegram Bot (ChatGPT + Midjourney)

> **–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:** –ì–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É Telegram‚Äë–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–µ–¥–∏–Ω—è–µ—Ç ChatGPT –∏ Midjourney; –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏, –æ–ø–ª–∞—Ç—ã, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –º–µ—Ö–∞–Ω–∏–∫—É –∏ –≤–µ–±—Ö—É–∫–∏ –Ω–∞ FastAPI.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ó–∞–ø—Ä–æ—Å—ã –∫ **ChatGPT –∏ Midjourney** –ø—Ä—è–º–æ –≤ Telegram (—á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ API).
- **–û–ø–ª–∞—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏:** Tinkoff, FreeKassa, PayOK, –∫—Ä–∏–ø—Ç–æ, Telegram Stars, –ø—Ä–æ–º–æ–∫–æ–¥—ã/—Å–∫–∏–¥–∫–∏.
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å –±–æ–Ω—É—Å–∞–º–∏.
- **FastAPI**‚Äë—Å–µ—Ä–≤–∏—Å—ã –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç –∏ –∫–æ–ª–±—ç–∫–æ–≤ Midjourney.
- **PostgreSQL** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, **APScheduler** –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞—á.
- **–û—Ç–¥–µ–ª—å–Ω—ã–π notify‚Äë—Å–µ—Ä–≤–∏—Å** –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ)
- **Bot** ‚Äî —Ä–∞–Ω–Ω–µ—Ä [`aiogram` v2] –≤ —Ä–µ–∂–∏–º–µ long‚Äëpolling (`main.py`).
- **API server** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `FastAPI` –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –æ–ø–ª–∞—Ç –∏ —Å–æ–±—ã—Ç–∏–π Midjourney (`api_server.py`).
- **Notify server** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `FastAPI` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notify_server.py`).
- **DB** ‚Äî PostgreSQL.
- **Scheduler** ‚Äî APScheduler (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏–µ cron‚Äë–∑–∞–¥–∞—á–∏).

```
Telegram ‚áÑ Aiogram bot
        ‚Üò                ‚Üò
       FastAPI (webhooks)  Notify FastAPI (delayed jobs)
             ‚Üò                ‚Üò
             PostgreSQL  ‚Üê‚Äî APScheduler
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1) –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python **3.12**
- PostgreSQL 13+
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Nginx / reverse proxy –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤

### 2) –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
git clone <your-repo-url> ai-telegram-bot
cd ai-telegram-bot
python -m venv .venv && source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

### 3) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã**.
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –æ–±–æ–ª–æ—á–∫–µ –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç‚Äë–º–µ–Ω–µ–¥–∂–µ—Ä–µ.

```dotenv
# Telegram
TELEGRAM_BOT_TOKEN=

# OpenAI / LLM provider
OPENAI_API_KEY=

# Midjourney relay (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
MIDJOURNEY_API_KEY=

# –ü–ª–∞—Ç–µ–∂–∏ (–∑–∞–ø–æ–ª–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ)
TINKOFF_TERMINAL_ID=
TINKOFF_API_TOKEN=
FREEKASSA_SHOP_ID=
FREEKASSA_SECRET=
PAYOK_SHOP_ID=
PAYOK_SECRET=
LAVA_API_KEY=
LAVA_SHOP_ID=
CRYPTO_ID=
CRYPTO_API_KEY=

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ADMINS_CSV=123456789,987654321
LOG_LEVEL=INFO
NOTIFY_URL=http://127.0.0.1:8001

# Postgres
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/your_db
```

> **–ü–æ–¥—Å–∫–∞–∑–∫–∞:** –ü—Ä–æ–±—Ä–æ—Å—å—Ç–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å–ª–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏; –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å—Ç–µ –∫—Ä–µ–¥–µ–Ω—à–µ–ª—ã.
> –ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã —Ä–∞–Ω—å—à–µ –ª–µ–∂–∞–ª–∏ –≤ –∫–æ–¥–µ ‚Äî **—Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏** –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º.

### 4) –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–°–æ–∑–¥–∞–π—Ç–µ –ë–î –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ SQL/–º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å). –ü—Ä–∏–º–µ—Ä:
```bash
createdb your_db
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ init‚Äë—Å–∫—Ä–∏–ø—Ç—ã
```

### 5) –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

**Bot (long‚Äëpolling):**
```bash
python main.py
```

**API‚Äë—Å–µ—Ä–≤–µ—Ä (–≤–µ–±—Ö—É–∫–∏ –æ–ø–ª–∞—Ç –∏ Midjourney):**
```bash
uvicorn api_server:app --host 0.0.0.0 --port 8000
```

**Notify‚Äë—Å–µ—Ä–≤–µ—Ä (–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è):**
```bash
uvicorn notify_server:app --host 0.0.0.0 --port 8001
```

### 6) –ü—Ä–æ–±—Ä–æ—Å –≤–µ–±—Ö—É–∫–æ–≤
–ß–µ—Ä–µ–∑ Nginx/Cloudflare/etc. –ø—Ä–æ–∫–∏–Ω—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ API‚Äë—Å–µ—Ä–≤–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- `POST /api/pay/tinkoff`
- `GET  /api/pay/freekassa`
- `POST /api/pay/lava`
- `POST /api/pay/payok`
- `POST /api/midjourney` –∏ `POST /api/midjourney/{action_id}`
- `POST /api/midjourney/choose`, `POST /api/midjourney/button`
- `POST /api/pay/tinkoff/receipt`

## üîÅ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (APScheduler)
–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron‚Äë–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–æ–¥–µ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

## üß™ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ngrok`/`cloudflared` –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
- –î–µ—Ä–∂–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π **—Ç–µ—Å—Ç–æ–≤—ã–π** –Ω–∞–±–æ—Ä API‚Äë–∫–ª—é—á–µ–π –∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤.

## üõ°Ô∏è –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –°–µ–∫—Ä–µ—Ç—ã ‚Äî –≤ env/—Ö—Ä–∞–Ω–∏–ª–∏—â–µ, **–Ω–µ** –≤ git
- [ ] –†–æ—Ç–∏—Ä—É–π—Ç–µ –ª—é–±—ã–µ –∑–∞—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏
- [ ] –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ IP –≤–µ–±—Ö—É–∫–æ–≤ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è) –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å–∏
- [ ] –í–∫–ª—é—á–∏—Ç–µ HTTPS –∏ HSTS –Ω–∞ —Ä–µ–≤–µ—Ä—Å‚Äë–ø—Ä–æ–∫—Å–∏
- [ ] –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∞–¥–º–∏–Ω‚Äë—Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –ø–æ ID/—Ä–æ–ª—è–º

## üì¶ –°—Ç–µ–∫
- Aiogram 2 ¬∑ FastAPI ¬∑ APScheduler
- PostgreSQL (asyncpg/SQLAlchemy –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –í–Ω–µ—à–Ω–∏–µ LLM/–∏–º–∏–¥–∂‚ÄëAPI (ChatGPT, Midjourney)
- –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Tinkoff, FreeKassa, PayOK, –∫—Ä–∏–ø—Ç–æ, Telegram Stars)


